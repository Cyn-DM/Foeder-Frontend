import { createHotContext as __vite__createHotContext } from "/@vite/client";import.meta.hot = __vite__createHotContext("/src/Authentication/AuthProvider.jsx");import __vite__cjsImport0_react_jsxDevRuntime from "/node_modules/.vite/deps/react_jsx-dev-runtime.js?v=1cc70104"; const jsxDEV = __vite__cjsImport0_react_jsxDevRuntime["jsxDEV"];
import RefreshRuntime from "/@react-refresh";
const inWebWorker = typeof WorkerGlobalScope !== "undefined" && self instanceof WorkerGlobalScope;
let prevRefreshReg;
let prevRefreshSig;
if (import.meta.hot && !inWebWorker) {
  if (!window.__vite_plugin_react_preamble_installed__) {
    throw new Error("@vitejs/plugin-react can't detect preamble. Something is wrong. See https://github.com/vitejs/vite-plugin-react/pull/11#discussion_r430879201");
  }
  prevRefreshReg = window.$RefreshReg$;
  prevRefreshSig = window.$RefreshSig$;
  window.$RefreshReg$ = (type, id) => {
    RefreshRuntime.register(type, "C:/Fontys repos/Foeder/Foeder Frontend/Foeder-Frontend/Foeder-Frontend/src/Authentication/AuthProvider.jsx " + id);
  };
  window.$RefreshSig$ = RefreshRuntime.createSignatureFunctionForTransform;
}
var _s = $RefreshSig$(), _s2 = $RefreshSig$();
import __vite__cjsImport3_react from "/node_modules/.vite/deps/react.js?v=1cc70104"; const createContext = __vite__cjsImport3_react["createContext"]; const useContext = __vite__cjsImport3_react["useContext"]; const useEffect = __vite__cjsImport3_react["useEffect"]; const useState = __vite__cjsImport3_react["useState"];
import __vite__cjsImport4_propTypes from "/node_modules/.vite/deps/prop-types.js?v=1cc70104"; const PropTypes = __vite__cjsImport4_propTypes.__esModule ? __vite__cjsImport4_propTypes.default : __vite__cjsImport4_propTypes;
import { useNavigate } from "/node_modules/.vite/deps/react-router-dom.js?v=1cc70104";
import axios from "/node_modules/.vite/deps/axios.js?v=1cc70104";
import { jwtDecode } from "/node_modules/.vite/deps/jwt-decode.js?v=1cc70104";
const AuthContext = createContext(null);
export function AuthProvider({ children }) {
  _s();
  const [isAuthenticated, setIsAuthenticated] = useState(false);
  const [user, setUser] = useState(null);
  let backendUrl = "https://localhost:7058/api";
  const axiosInstance = axios.create({
    baseURL: backendUrl,
    withCredentials: true
  });
  useEffect(() => {
    setAccessTokenFromRefresh();
  }, []);
  axiosInstance.interceptors.request.use(
    (config) => {
      const accessToken = localStorage.getItem("access_token");
      if (accessToken) {
        config.headers["Authorization"] = accessToken;
      } else {
        setAccessTokenFromRefresh();
      }
      return config;
    },
    (error) => Promise.reject(error)
  );
  AuthProvider.propTypes = {
    children: PropTypes.any
  };
  const createUser = (accessToken) => {
    let userInfo = jwtDecode(accessToken);
    console.log(userInfo);
    return {
      "name": userInfo.unique_name,
      "id": userInfo.Id,
      "email": userInfo.email,
      "householdId": userInfo.HouseholdId ?? void 0
    };
  };
  const login = (user2) => {
    setUser(user2);
    setIsAuthenticated(true);
  };
  const clearAccessToken = () => {
    if (localStorage.getItem("access_token")) {
      localStorage.removeItem("accessToken");
    }
  };
  const clearRefreshToken = () => {
    const skipIntercept = axios.create();
    skipIntercept.defaults.baseURL = backendUrl;
    skipIntercept.withCredentials = true;
    skipIntercept.get("/Auth/logout").catch((error) => console.log(error));
  };
  const logout = () => {
    setUser(null);
    setIsAuthenticated(false);
    clearAccessToken();
    clearRefreshToken();
  };
  const getAccessToken = () => {
    return localStorage.getItem("access_token");
  };
  const setAccessTokenLocalStorage = (accessToken) => {
    if (localStorage.getItem("access_token")) {
      localStorage.removeItem("access_token");
    }
    localStorage.setItem("access_token", `Bearer ${accessToken}`);
  };
  const setAccessTokenFromRefresh = () => {
    axios.get("/Auth/refresh", { withCredentials: true, baseURL: backendUrl }).then((response) => {
      setAccessTokenLocalStorage(response.data);
      const createdUser = createUser(response.data);
      login(createdUser);
    }).catch((error) => {
      if (error.response && error.response.status === 401) {
        logout();
      }
    });
  };
  const handleCredentialResponse = (response) => {
    const skipIntercept = axios.create();
    skipIntercept.defaults.baseURL = backendUrl;
    skipIntercept.defaults.withCredentials = true;
    skipIntercept.post(
      "/Auth/login",
      { CredentialResponse: response.credential }
    ).then((response2) => {
      setAccessTokenLocalStorage(response2.data);
      let user2 = createUser(response2.data);
      login(user2);
    }).catch((error) => console.error("Connection error:", error));
  };
  return /* @__PURE__ */ jsxDEV(AuthContext.Provider, { value: {
    isAuthenticated,
    setIsAuthenticated,
    user,
    createUser,
    login,
    logout,
    getAccessToken,
    setAccessToken: setAccessTokenFromRefresh,
    handleCredentialResponse,
    axiosInstance
  }, children }, void 0, false, {
    fileName: "C:/Fontys repos/Foeder/Foeder Frontend/Foeder-Frontend/Foeder-Frontend/src/Authentication/AuthProvider.jsx",
    lineNumber: 135,
    columnNumber: 5
  }, this);
}
_s(AuthProvider, "Cix+uXOU60jwVTrRl9ss+REDA3M=");
_c = AuthProvider;
export function UseAuth() {
  _s2();
  return useContext(AuthContext);
}
_s2(UseAuth, "gDsCjeeItUuvgOWf1v4qoK9RF6k=");
_c2 = UseAuth;
var _c, _c2;
$RefreshReg$(_c, "AuthProvider");
$RefreshReg$(_c2, "UseAuth");
if (import.meta.hot && !inWebWorker) {
  window.$RefreshReg$ = prevRefreshReg;
  window.$RefreshSig$ = prevRefreshSig;
}
if (import.meta.hot && !inWebWorker) {
  RefreshRuntime.__hmr_import(import.meta.url).then((currentExports) => {
    RefreshRuntime.registerExportsForReactRefresh("C:/Fontys repos/Foeder/Foeder Frontend/Foeder-Frontend/Foeder-Frontend/src/Authentication/AuthProvider.jsx", currentExports);
    import.meta.hot.accept((nextExports) => {
      if (!nextExports) return;
      const invalidateMessage = RefreshRuntime.validateRefreshBoundaryAndEnqueueUpdate("C:/Fontys repos/Foeder/Foeder Frontend/Foeder-Frontend/Foeder-Frontend/src/Authentication/AuthProvider.jsx", currentExports, nextExports);
      if (invalidateMessage) import.meta.hot.invalidate(invalidateMessage);
    });
  });
}

//# sourceMappingURL=data:application/json;base64,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VCxnQkFBUzJELFVBQVM7QUFBQUMsTUFBQTtBQUNyQixTQUFPbkUsV0FBV00sV0FBVztBQUNqQztBQUFDNkQsSUFGZUQsU0FBTztBQUFBRSxNQUFQRjtBQUFPLElBQUFELElBQUFHO0FBQUFDLGFBQUFKLElBQUE7QUFBQUksYUFBQUQsS0FBQSIsIm5hbWVzIjpbImNyZWF0ZUNvbnRleHQiLCJ1c2VDb250ZXh0IiwidXNlU3RhdGUiLCJQcm9wVHlwZXMiLCJ1c2VOYXZpZ2F0ZSIsImF4aW9zIiwiand0RGVjb2RlIiwiQXV0aENvbnRleHQiLCJBdXRoUHJvdmlkZXIiLCJjaGlsZHJlbiIsIl9zIiwiaXNBdXRoZW50aWNhdGVkIiwic2V0SXNBdXRoZW50aWNhdGVkIiwidXNlciIsInNldFVzZXIiLCJiYWNrZW5kVXJsIiwiYXhpb3NJbnN0YW5jZSIsImNyZWF0ZSIsImJhc2VVUkwiLCJ3aXRoQ3JlZGVudGlhbHMiLCJ1c2VFZmZlY3QiLCJzZXRBY2Nlc3NUb2tlbkZyb21SZWZyZXNoIiwiaW50ZXJjZXB0b3JzIiwicmVxdWVzdCIsInVzZSIsImNvbmZpZyIsImFjY2Vzc1Rva2VuIiwibG9jYWxTdG9yYWdlIiwiZ2V0SXRlbSIsImhlYWRlcnMiLCJlcnJvciIsIlByb21pc2UiLCJyZWplY3QiLCJwcm9wVHlwZXMiLCJhbnkiLCJjcmVhdGVVc2VyIiwidXNlckluZm8iLCJjb25zb2xlIiwibG9nIiwidW5pcXVlX25hbWUiLCJJZCIsImVtYWlsIiwiSG91c2Vob2xkSWQiLCJ1bmRlZmluZWQiLCJsb2dpbiIsImNsZWFyQWNjZXNzVG9rZW4iLCJyZW1vdmVJdGVtIiwiY2xlYXJSZWZyZXNoVG9rZW4iLCJza2lwSW50ZXJjZXB0IiwiZGVmYXVsdHMiLCJnZXQiLCJjYXRjaCIsImxvZ291dCIsImdldEFjY2Vzc1Rva2VuIiwic2V0QWNjZXNzVG9rZW5Mb2NhbFN0b3JhZ2UiLCJzZXRJdGVtIiwidGhlbiIsInJlc3BvbnNlIiwiZGF0YSIsImNyZWF0ZWRVc2VyIiwic3RhdHVzIiwiaGFuZGxlQ3JlZGVudGlhbFJlc3BvbnNlIiwicG9zdCIsIkNyZWRlbnRpYWxSZXNwb25zZSIsImNyZWRlbnRpYWwiLCJzZXRBY2Nlc3NUb2tlbiIsIl9jIiwiVXNlQXV0aCIsIl9zMiIsIl9jMiIsIiRSZWZyZXNoUmVnJCJdLCJpZ25vcmVMaXN0IjpbXSwic291cmNlcyI6WyJBdXRoUHJvdmlkZXIuanN4Il0sInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7Y3JlYXRlQ29udGV4dCwgdXNlQ29udGV4dCwgdXNlRWZmZWN0LCB1c2VTdGF0ZX0gZnJvbSBcInJlYWN0XCI7XHJcbmltcG9ydCBQcm9wVHlwZXMgZnJvbSAncHJvcC10eXBlcyc7XHJcbmltcG9ydCB7dXNlTmF2aWdhdGV9IGZyb20gJ3JlYWN0LXJvdXRlci1kb20nO1xyXG5pbXBvcnQgYXhpb3MgZnJvbSBcImF4aW9zXCI7XHJcbmltcG9ydCB7and0RGVjb2RlfSBmcm9tIFwiand0LWRlY29kZVwiO1xyXG5jb25zdCBBdXRoQ29udGV4dCA9IGNyZWF0ZUNvbnRleHQobnVsbClcclxuXHJcbmV4cG9ydCBmdW5jdGlvbiBBdXRoUHJvdmlkZXIoe2NoaWxkcmVufSlcclxue1xyXG4gICAgY29uc3QgW2lzQXV0aGVudGljYXRlZCwgc2V0SXNBdXRoZW50aWNhdGVkXSA9IHVzZVN0YXRlKGZhbHNlKTtcclxuICAgIGNvbnN0IFt1c2VyLCBzZXRVc2VyXSA9IHVzZVN0YXRlKG51bGwpO1xyXG4gICAgbGV0IGJhY2tlbmRVcmwgPSAnaHR0cHM6Ly9sb2NhbGhvc3Q6NzA1OC9hcGknO1xyXG5cclxuICAgIGNvbnN0IGF4aW9zSW5zdGFuY2UgPSBheGlvcy5jcmVhdGUoe1xyXG4gICAgICAgIGJhc2VVUkw6IGJhY2tlbmRVcmwsXHJcbiAgICAgICAgd2l0aENyZWRlbnRpYWxzOiB0cnVlLFxyXG4gICAgfSk7XHJcblxyXG4gICAgdXNlRWZmZWN0KCgpID0+IHtcclxuICAgICAgICBzZXRBY2Nlc3NUb2tlbkZyb21SZWZyZXNoKClcclxuICAgIH0sIFtdKVxyXG5cclxuICAgIGF4aW9zSW5zdGFuY2UuaW50ZXJjZXB0b3JzLnJlcXVlc3QudXNlKFxyXG4gICAgICAgIChjb25maWcpID0+IHtcclxuICAgICAgICAgICAgY29uc3QgYWNjZXNzVG9rZW4gPSBsb2NhbFN0b3JhZ2UuZ2V0SXRlbSgnYWNjZXNzX3Rva2VuJyk7XHJcbiAgICAgICAgICAgIGlmIChhY2Nlc3NUb2tlbikge1xyXG4gICAgICAgICAgICAgICAgY29uZmlnLmhlYWRlcnNbJ0F1dGhvcml6YXRpb24nXSA9IGFjY2Vzc1Rva2VuO1xyXG4gICAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgc2V0QWNjZXNzVG9rZW5Gcm9tUmVmcmVzaCgpXHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgcmV0dXJuIGNvbmZpZztcclxuICAgICAgICB9LFxyXG4gICAgICAgIChlcnJvcikgPT4gUHJvbWlzZS5yZWplY3QoZXJyb3IpXHJcbiAgICApO1xyXG5cclxuLyogICAgYXhpb3NJbnN0YW5jZS5pbnRlcmNlcHRvcnMucmVzcG9uc2UudXNlKFxyXG4gICAgICAgIChyZXNwb25zZSkgPT4gcmVzcG9uc2UsXHJcbiAgICAgICAgYXN5bmMgKGVycm9yKSA9PiB7XHJcbiAgICAgICAgICAgIGNvbnN0IG9yaWdpbmFsUmVxdWVzdCA9IGVycm9yLmNvbmZpZztcclxuXHJcbiAgICAgICAgICAgIGlmKGVycm9yLnJlc3BvbnNlPy5zdGF0dXMgPT09IDQwMSAmJiAhb3JpZ2luYWxSZXF1ZXN0Ll9yZXRyeSl7XHJcbiAgICAgICAgICAgICAgICBvcmlnaW5hbFJlcXVlc3QuX3JldHJ5ID0gdHJ1ZTtcclxuXHJcbiAgICAgICAgICAgICAgICB0cnkge1xyXG4gICAgICAgICAgICAgICAgICAgIHNldEFjY2Vzc1Rva2VuRnJvbVJlZnJlc2goKVxyXG5cclxuICAgICAgICAgICAgICAgICAgICBjb25zdCBhY2Nlc3NUb2tlbiA9IGxvY2FsU3RvcmFnZS5nZXRJdGVtKCdhY2Nlc3NfdG9rZW4nKTtcclxuICAgICAgICAgICAgICAgICAgICBvcmlnaW5hbFJlcXVlc3QuZGVmYXVsdHMuaGVhZGVyc1snQXV0aG9yaXphdGlvbiddID0gYWNjZXNzVG9rZW47XHJcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGF4aW9zSW5zdGFuY2Uob3JpZ2luYWxSZXF1ZXN0KTtcclxuICAgICAgICAgICAgICAgIH0gY2F0Y2ggKHJlZnJlc2hFcnJvcikge1xyXG4gICAgICAgICAgICAgICAgICAgIGxvZ291dCgpXHJcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIFByb21pc2UucmVqZWN0KHJlZnJlc2hFcnJvcilcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfVxyXG59XHJcbiAgICApKi9cclxuXHJcbiAgICBBdXRoUHJvdmlkZXIucHJvcFR5cGVzID0ge1xyXG4gICAgICAgIGNoaWxkcmVuOiBQcm9wVHlwZXMuYW55XHJcbiAgICB9XHJcblxyXG4gICAgY29uc3QgY3JlYXRlVXNlciA9IChhY2Nlc3NUb2tlbikgPT4ge1xyXG4gICAgICAgIGxldCB1c2VySW5mbyA9IGp3dERlY29kZShhY2Nlc3NUb2tlbik7XHJcbiAgICAgICAgY29uc29sZS5sb2codXNlckluZm8pO1xyXG4gICAgICAgIHJldHVybiB7IFwibmFtZVwiIDogdXNlckluZm8udW5pcXVlX25hbWUsXHJcbiAgICAgICAgICAgIFwiaWRcIjogdXNlckluZm8uSWQsXHJcbiAgICAgICAgICAgIFwiZW1haWxcIiA6IHVzZXJJbmZvLmVtYWlsLFxyXG4gICAgICAgICAgICBcImhvdXNlaG9sZElkXCIgOiB1c2VySW5mby5Ib3VzZWhvbGRJZCA/PyB1bmRlZmluZWQsXHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG5cclxuICAgIGNvbnN0IGxvZ2luID0gKHVzZXIpID0+IHtcclxuICAgICAgICBzZXRVc2VyKHVzZXIpO1xyXG4gICAgICAgIHNldElzQXV0aGVudGljYXRlZCh0cnVlKTtcclxuICAgIH1cclxuXHJcbiAgICBjb25zdCBjbGVhckFjY2Vzc1Rva2VuID0gKCkgPT4ge1xyXG4gICAgICAgIGlmIChsb2NhbFN0b3JhZ2UuZ2V0SXRlbSgnYWNjZXNzX3Rva2VuJykpIHtcclxuICAgICAgICAgICAgbG9jYWxTdG9yYWdlLnJlbW92ZUl0ZW0oXCJhY2Nlc3NUb2tlblwiKTtcclxuICAgICAgICB9XHJcbiAgICB9XHJcblxyXG4gICAgY29uc3QgY2xlYXJSZWZyZXNoVG9rZW4gPSAoKSA9PiB7XHJcbiAgICAgICAgY29uc3Qgc2tpcEludGVyY2VwdCA9IGF4aW9zLmNyZWF0ZSgpO1xyXG4gICAgICAgIHNraXBJbnRlcmNlcHQuZGVmYXVsdHMuYmFzZVVSTCA9IGJhY2tlbmRVcmw7XHJcbiAgICAgICAgc2tpcEludGVyY2VwdC53aXRoQ3JlZGVudGlhbHMgPSB0cnVlO1xyXG4gICAgICAgIHNraXBJbnRlcmNlcHQuZ2V0KCcvQXV0aC9sb2dvdXQnLCApLmNhdGNoKChlcnJvcikgPT4gY29uc29sZS5sb2coZXJyb3IpKTtcclxuICAgIH1cclxuXHJcbiAgICBjb25zdCBsb2dvdXQgPSAoKSA9PiB7XHJcbiAgICAgICAgc2V0VXNlcihudWxsKTtcclxuICAgICAgICBzZXRJc0F1dGhlbnRpY2F0ZWQoZmFsc2UpO1xyXG4gICAgICAgIGNsZWFyQWNjZXNzVG9rZW4oKTtcclxuICAgICAgICBjbGVhclJlZnJlc2hUb2tlbigpO1xyXG4gICAgfVxyXG5cclxuICAgIGNvbnN0IGdldEFjY2Vzc1Rva2VuID0gKCkgPT4ge1xyXG4gICAgICAgIHJldHVybiBsb2NhbFN0b3JhZ2UuZ2V0SXRlbSgnYWNjZXNzX3Rva2VuJyk7XHJcbiAgICB9XHJcblxyXG4gICAgY29uc3Qgc2V0QWNjZXNzVG9rZW5Mb2NhbFN0b3JhZ2UgPSAoYWNjZXNzVG9rZW4pID0+IHtcclxuICAgICAgICBpZiAobG9jYWxTdG9yYWdlLmdldEl0ZW0oJ2FjY2Vzc190b2tlbicpKSB7XHJcbiAgICAgICAgICAgIGxvY2FsU3RvcmFnZS5yZW1vdmVJdGVtKCdhY2Nlc3NfdG9rZW4nKTtcclxuICAgICAgICB9XHJcbiAgICAgICAgbG9jYWxTdG9yYWdlLnNldEl0ZW0oJ2FjY2Vzc190b2tlbicsIGBCZWFyZXIgJHthY2Nlc3NUb2tlbn1gKTtcclxuICAgIH1cclxuXHJcbiAgICBjb25zdCBzZXRBY2Nlc3NUb2tlbkZyb21SZWZyZXNoID0gKCkgPT4ge1xyXG4gICAgICAgIGF4aW9zLmdldChcIi9BdXRoL3JlZnJlc2hcIiwge3dpdGhDcmVkZW50aWFsczogdHJ1ZSwgYmFzZVVSTDogYmFja2VuZFVybH0pLnRoZW4oKHJlc3BvbnNlKSA9PiB7XHJcbiAgICAgICAgICAgIHNldEFjY2Vzc1Rva2VuTG9jYWxTdG9yYWdlKHJlc3BvbnNlLmRhdGEpO1xyXG4gICAgICAgICAgICBjb25zdCBjcmVhdGVkVXNlciA9IGNyZWF0ZVVzZXIocmVzcG9uc2UuZGF0YSk7XHJcbiAgICAgICAgICAgIGxvZ2luKGNyZWF0ZWRVc2VyKTtcclxuICAgICAgICB9KVxyXG4gICAgICAgICAgICAuY2F0Y2goKGVycm9yKSA9PiB7XHJcbiAgICAgICAgICAgICAgICBpZiAoZXJyb3IucmVzcG9uc2UgJiYgZXJyb3IucmVzcG9uc2Uuc3RhdHVzID09PSA0MDEpIHtcclxuICAgICAgICAgICAgICAgICAgICBsb2dvdXQoKTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfSlcclxuICAgIH1cclxuXHJcbiAgICBjb25zdCBoYW5kbGVDcmVkZW50aWFsUmVzcG9uc2UgPSAocmVzcG9uc2UpID0+IHtcclxuICAgICAgICBjb25zdCBza2lwSW50ZXJjZXB0ID0gYXhpb3MuY3JlYXRlKCk7XHJcbiAgICAgICAgc2tpcEludGVyY2VwdC5kZWZhdWx0cy5iYXNlVVJMID0gYmFja2VuZFVybDtcclxuICAgICAgICBza2lwSW50ZXJjZXB0LmRlZmF1bHRzLndpdGhDcmVkZW50aWFscyA9IHRydWU7XHJcbiAgICAgICAgc2tpcEludGVyY2VwdC5wb3N0KCcvQXV0aC9sb2dpbicsXHJcbiAgICAgICAgICAgIHtDcmVkZW50aWFsUmVzcG9uc2U6IHJlc3BvbnNlLmNyZWRlbnRpYWx9LFxyXG4gICAgICAgICkudGhlbigocmVzcG9uc2UpID0+IHtcclxuICAgICAgICAgICAgc2V0QWNjZXNzVG9rZW5Mb2NhbFN0b3JhZ2UocmVzcG9uc2UuZGF0YSlcclxuICAgICAgICAgICAgbGV0IHVzZXIgPSBjcmVhdGVVc2VyKHJlc3BvbnNlLmRhdGEpO1xyXG4gICAgICAgICAgICBsb2dpbih1c2VyKTtcclxuICAgICAgICB9KS5jYXRjaChlcnJvciA9PiBjb25zb2xlLmVycm9yKCdDb25uZWN0aW9uIGVycm9yOicsIGVycm9yKSk7XHJcbiAgICB9XHJcblxyXG4gICAgcmV0dXJuIChcclxuICAgICAgICA8QXV0aENvbnRleHQuUHJvdmlkZXIgdmFsdWU9e3tcclxuICAgICAgICAgICAgaXNBdXRoZW50aWNhdGVkLFxyXG4gICAgICAgICAgICBzZXRJc0F1dGhlbnRpY2F0ZWQsXHJcbiAgICAgICAgICAgIHVzZXIsXHJcbiAgICAgICAgICAgIGNyZWF0ZVVzZXIsXHJcbiAgICAgICAgICAgIGxvZ2luLFxyXG4gICAgICAgICAgICBsb2dvdXQsXHJcbiAgICAgICAgICAgIGdldEFjY2Vzc1Rva2VuLFxyXG4gICAgICAgICAgICBzZXRBY2Nlc3NUb2tlbjogc2V0QWNjZXNzVG9rZW5Gcm9tUmVmcmVzaCxcclxuICAgICAgICAgICAgaGFuZGxlQ3JlZGVudGlhbFJlc3BvbnNlLFxyXG4gICAgICAgICAgICBheGlvc0luc3RhbmNlXHJcbiAgICAgICAgfX0+XHJcbiAgICAgICAgICAgIHtjaGlsZHJlbn1cclxuICAgICAgICA8L0F1dGhDb250ZXh0LlByb3ZpZGVyPlxyXG4gICAgKTtcclxufVxyXG5cclxuZXhwb3J0IGZ1bmN0aW9uIFVzZUF1dGgoKXtcclxuICAgIHJldHVybiB1c2VDb250ZXh0KEF1dGhDb250ZXh0KTtcclxufVxyXG5cclxuXHJcblxyXG4iXSwiZmlsZSI6IkM6L0ZvbnR5cyByZXBvcy9Gb2VkZXIvRm9lZGVyIEZyb250ZW5kL0ZvZWRlci1Gcm9udGVuZC9Gb2VkZXItRnJvbnRlbmQvc3JjL0F1dGhlbnRpY2F0aW9uL0F1dGhQcm92aWRlci5qc3gifQ==